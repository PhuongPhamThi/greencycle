<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GREENCYCLE - Quên mật khẩu</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.4.1/flowbite.min.css" rel="stylesheet" />

    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-100 dark:bg-gray-900">

    <header id="navbar-placeholder"></header>

    <section class="flex-1 flex justify-center items-center w-full p-4">
        <div class="w-full max-w-md p-6 bg-white rounded-lg shadow dark:bg-gray-800 dark:border dark:border-gray-700">
            <div class="text-center mb-6">
                <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600 dark:bg-green-900 dark:text-green-300">
                    <i class="fas fa-key fa-lg"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Quên mật khẩu?</h2>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Nhập email của bạn, chúng tôi sẽ gửi đường dẫn để bạn đặt lại mật khẩu mới.</p>
            </div>

            <form id="resetForm" class="space-y-5">
                <div>
                    <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email đăng ký</label>
                    <input type="email" name="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="ten@greencycle.com" required>
                </div>
                <button type="submit" class="w-full text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800" id="resetBtn">
                    Gửi link đặt lại
                </button>
            </form>

            <div class="mt-6 text-center">
                <a href="/login.html" class="text-sm font-medium text-green-600 hover:underline dark:text-green-500 inline-flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Quay lại Đăng nhập
                </a>
            </div>
        </div>
    </section>

    <footer id="footer-placeholder"></footer>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script src="js/jwt-decode.min.js"></script> 
    <script src="script.js"></script> 
    <script src="js/navbar.js"></script> 
    <script src="js/footer.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.4.1/flowbite.min.js"></script>

    <script>
        // Cấu hình Firebase (Giống hệt file login.html của bạn)
        const firebaseConfig = {
            apiKey: "AIzaSyBRucHKlUpBsYegzc-OXAd7_CyMDG2BfAA",
            authDomain: "greencycle-4ca3c.firebaseapp.com",
            databaseURL: "https://greencycle-4ca3c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "greencycle-4ca3c",
            storageBucket: "greencycle-4ca3c.firebasestorage.app",
            messagingSenderId: "692058245335",
            appId: "1:692058245335:web:7566b5ed4526e15d56c892",
            measurementId: "G-23M6XSHXK6"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();

        const resetForm = document.getElementById('resetForm');
        const resetBtn = document.getElementById('resetBtn');

        resetForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            
            // Hiệu ứng loading
            const originalText = resetBtn.textContent;
            resetBtn.textContent = "Đang gửi...";
            resetBtn.disabled = true;

            // Gửi email reset pass
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showToast("Email đã được gửi! Hãy kiểm tra hộp thư (cả mục Spam/Rác).", true);
                    resetForm.reset();
                })
                .catch((error) => {
                    console.error(error);
                    let msg = "Lỗi không xác định.";
                    if (error.code === 'auth/user-not-found') msg = "Email này chưa được đăng ký.";
                    if (error.code === 'auth/invalid-email') msg = "Email không hợp lệ.";
                    showToast(msg, false);
                })
                .finally(() => {
                    resetBtn.textContent = originalText;
                    resetBtn.disabled = false;
                });
        });
    </script>
</body>
</html>